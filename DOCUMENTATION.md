# CSV Shell

A tiny interactive console for organizing users (as data containers) and attaching CSV files to them.  
It ships with a minimal CLI (create users, attach CSVs, list things) and a small Python API (head/tail, per-column sort, median, top-K).

> On launch the shell creates a user named **`sudo`** and enters its context.

---

## Contents
- [Requirements](#requirements)
- [Installation](#installation)
- [Running](#running)
- [How to Use (CLI)](#how-to-use-cli)
  - [Command Reference](#command-reference)
  - [Examples](#examples)
- [Working with CSV Data](#working-with-csv-data)
- [Python API Recipes](#python-api-recipes)
- [Troubleshooting](#troubleshooting)
- [Built-in Documentation (as printed by `documentation`)](#built-in-documentation-as-printed-by-documentation)
- [Notes & Limitations](#notes--limitations)
- [Project Layout](#project-layout)

---

## Requirements
- Python **3.10+**
- Packages:
  ```bash
  pip install numpy
  ```

---

## Installation
Clone/copy the project. No build step needed.

```
.
├── main.py                 # entry point (runs the shell)
├── documentation.txt       # shown by the `documentation` command
└── homework_oop/
    └── repositories.csv    # default CSV used if path is omitted (optional)
```

> If your entry file is not `main.py`, adjust commands accordingly.

---

## Running
From the project root:

```bash
python main.py
```

On start you’ll see a greeting and the prompt:

- `(./<user>) >>>` — inside a user (e.g., `(./sudo) >>>`)
- `(./) >>>`       — root (no user selected)

Exit with: `quit` or `q`.

---

## How to Use (CLI)

### Command Reference

#### `documentation`
Prints `./documentation.txt`.

```
(./sudo) >>> documentation
```

#### `ls`
Lists the current context:

- In root `(./)`: all user names (one per line).
- In a user `(./<user>)`: that user’s CSV names (one per line).

```
(./)      >>> ls
analysts
sudo

(./sudo)  >>> ls
iris
```

#### `cd`
Change context. User names may contain spaces (everything after the first argument is treated as part of the name).

Supported forms:
- `cd /`           → go to root `(./)`.
- `cd ..`          → go to root `(./)`.
- `cd /<user>`     → jump to that user from **anywhere**.
- `cd <user>`      → **works only from root**.
- `cd ./<user>`    → **works only from root** (treated like `cd <user>`).
- `cd .`           → no-op.

Invalid input:
- Strings that *start with* `...` are rejected.

Exact error messages:
- Unknown user: `A user with that name does not exist`
- Not allowed from here: `Incorrect transition`
- Incorrect path string: `Incorrect path provided`

#### `add user [<name>]`
Create a user (**only in root**).

Behavior:
- No name → random SpongeBob-style name + timestamp.
- Name must **not** start with `.` or `/`.
- Duplicate names are rejected.

Exact messages:
- Wrong place: `Incorrect directory for creating a new user`
- Bad leading char: `I'm sorry, but the username cannot begin with the characters . or /`
- Duplicate: `This name is already exists`
- Success: `Add new user <name>`

#### `add csv [<path>] [--name=<csv_name ...>]`
Attach a CSV to the **current user** (not allowed in root).

Path handling:
- If `<path>` is omitted, uses: `./homework_oop/repositories.csv`.
- A normalizer processes the path string.
- Existence is checked with `Path(...).expanduser()`, **but opening uses the original string**.
  - **Tip:** avoid `~`; use absolute or relative paths without `~`.

Name handling:
- If `--name=` is omitted → auto-name: `default_1`, `default_2`, …
- Everything after `--name=` becomes part of the name (spaces allowed).

Tokenization tip:
- The path is read until the first token starting with `--name=`.
- If your path contains spaces, quote it in your outer shell:
  ```bash
  (./sudo) >>> add csv "./data with spaces/iris.csv" --name=Iris 2024
  ```

Exact messages:
- In root: `I'm sorry, but add csv cannot be used in the root directory`
- Path not a file: `Incorrect path provided`
- Duplicate CSV name: `This name is already exists`
- Success: `Add new csv file <csv_name> to the user <user>`

#### `quit` / `q`
Exit.

---

### Examples

**Startup & list**
```
(./sudo) >>> ls
# (nothing yet)
```

**Attach a CSV with autogenerated name**
```
(./sudo) >>> add csv ./datasets/iris.csv
Add new csv file default_1 to the user sudo
(./sudo) >>> ls
default_1
```

**Attach with a custom name (spaces allowed)**
```
(./sudo) >>> add csv ./data/sales.csv --name=Sales 2024 Q4
Add new csv file Sales 2024 Q4 to the user sudo
(./sudo) >>> ls
default_1
Sales 2024 Q4
```

**Create and switch users**
```
(./sudo) >>> cd /
(./) >>> add user data team
Add new user data team
(./) >>> cd data team
(./data team) >>> ls
# (nothing yet)
```

**Switch directly from anywhere**
```
(./data team) >>> cd /sudo
(./sudo) >>>
```

**Show the built-in docs**
```
(./sudo) >>> documentation
# prints documentation.txt
```

**Common errors**
```
(./) >>> add user data team
This name is already exists

(./sudo) >>> add csv ./no/such/file.csv
Incorrect path provided

(./sudo) >>> cd unknown
A user with that name does not exist

(./sudo) >>> cd ./data team
Incorrect transition
```

---

## Working with CSV Data
When a CSV is loaded:
- The **first row** is treated as the header (column names).
- Data rows are stored as `np.array(object)` rows inside a custom dynamic `Vector`.
- Each column is type-cast as a whole (best-effort):
  1) `int` → 2) `float` → 3) `bool` (`"true"`/`"false"`, case-insensitive) →  
  4) Python `list`/`tuple` via `ast.literal_eval`; otherwise left as strings.

---

## Python API Recipes

> The functions below are available inside the code but not wired into the CLI.  
> You can import and use them from Python.

```python
from main import ReadCSV, python_sort_column, medianByColumn, getNBestByColumn

# Load a CSV
t = ReadCSV("./datasets/iris.csv")

# Column names
print(t.getColumnNames())  # e.g. ['sepal_length', 'sepal_width', 'petal_length', 'petal_width', 'species']

# Head/Tail as new ReadCSV objects
head5 = t.head(5)
tail10 = t.tail(10)

# Extract a column by name
species_vec = t.getColumnByName("species")

# Sort a single column (ascending) by name or index → returns a 1-column ReadCSV
pl_sorted = python_sort_column(t, "petal_length")

# Top-K largest values from a column
pl_top3 = getNBestByColumn(t, "petal_length", 3)

# Median of a numeric column
m = medianByColumn(t, "sepal_width")
print("Median:", m)
```

**Important details**
- `python_sort_column(csv, None)` sorts **each column independently** and reassembles rows — row relations are **not** preserved.
- `needed_type` and `key` parameters in `python_sort_column` are currently ignored.

---

## Troubleshooting

**“I'm sorry, I couldn't understand the command”**  
The input doesn’t match any supported command.

**“Incorrect directory for creating a new user”**  
You ran `add user` while inside a user. Go to root with `cd /` first.

**“I'm sorry, but add csv cannot be used in the root directory”**  
Select a user first (`cd /<user>`).

**“Incorrect path provided”**  
Malformed path or file not found.  
Tip: Avoid `~`; quote paths that contain spaces.

**“This name is already exists”**  
A user or CSV with the same name already exists in the current scope.

**Switching users cleanly**  
From anywhere, use `cd /<name>`. From root, `cd <name>` also works.

---

## Built-in Documentation (as printed by `documentation`)

```
CSV Shell — TEXT DOCUMENTATION (for documentation.txt)

Purpose
-------
A tiny console to work with CSV files:
• create lightweight “users” (data containers);
• attach CSV files to a user;
• list what’s attached;
• (in code) simple table helpers such as head/tail, per-column sorting, median, top-K (available via functions but not exposed as CLI commands yet).

Startup, prompt, and exit
------------------------
• On start the shell creates a user named `sudo` and enters its context.
• Prompt format:
  (./<user>) >>>      — inside a user (e.g., (./sudo) >>>)
  (./) >>>            — root (no user selected)
• Exit commands: `quit` or `q`.

Commands (current build)
------------------------

1) documentation
   Print this very file (./documentation.txt).

2) ls
   List the contents of the current context.
   • In root (./): prints all user names, one per line.
   • In a user (./<user>): prints that user’s CSV names, one per line.

3) cd
   Change context. User names may contain spaces — everything after the first argument
   is treated as part of the name.

   Supported forms:
   • cd /            — go to root (./).
   • cd ..           — go to root (./).
   • cd /<user>      — jump to that user from anywhere.
   • cd <user>       — works ONLY from root.
   • cd ./<user>     — works ONLY from root (treated like `cd <user>`).
   • cd .            — no-op.

   Invalid prefix:
   • Paths that begin with three dots (`...`) are rejected as incorrect.

   Exact error messages:
   • Unknown user:                A user with that name does not exist
   • Not allowed from here:       Incorrect transition
   • Incorrect path string:       Incorrect path provided

4) add user [<name>]
   Create a new user (ONLY in root).

   Behavior:
   • Without a name, a random SpongeBob-style name with a timestamp is generated.
   • Names must NOT start with `.` or `/`.
   • Duplicate names are rejected.

   Exact messages:
   • Wrong place (not in root):   Incorrect directory for creating a new user
   • Bad leading char:            I'm sorry, but the username cannot begin with the characters . or /
   • Duplicate:                   This name is already exists
   • Success:                     Add new user <name>

5) add csv [<path>] [--name=<csv_name ...>]
   Attach a CSV file to the CURRENT user (NOT allowed in root).

   Path handling:
   • If <path> is omitted, the shell uses:
       ./homework_oop/repositories.csv
   • The string is normalized by an internal path normalizer.
   • The code checks existence using `expanduser()` BUT then passes the ORIGINAL
     (possibly unexpanded) path to file opening. To avoid surprises, do NOT use `~`
     in the path; provide an absolute or relative path without `~`.

   Name handling:
   • If `--name=` is omitted, a default name is assigned: default_1, default_2, ...
   • Everything after `--name=` until the end of the command is appended, so names
     may contain spaces (e.g., `--name=Sales 2024 Q4`).

   Tokenization note:
   • The path is parsed until the first token starting with `--name=`.
   • If your path contains spaces, quote it in your shell so it comes in
     as one token.

   Exact messages:
   • Called in root:              I'm sorry, but add csv cannot be used in the root directory
   • Path not a file:             Incorrect path provided
   • Duplicate CSV name:          This name is already exists
   • Success:                     Add new csv file <csv_name> to the user <user>

6) quit / q
   Exit the shell.

Messages & errors (reference)
-----------------------------
• I'm sorry, I couldn't understand the command         — unknown command
• A user with that name does not exist                 — cd target user is missing
• Incorrect transition                                 — disallowed `cd` form from current context
• Incorrect path provided                              — path is malformed or not a file for `add csv`
• Incorrect directory for creating a new user          — `add user` invoked outside root
• I'm sorry, but the username cannot begin with the characters . or /
• I'm sorry, but add csv cannot be used in the root directory
• This name is already exists                          — duplicate user/CSV name
```
---

## Notes & Limitations
- Start context is `(./sudo)`, not root.
- From inside any user, prefer `cd /<user>` to switch directly.  
  From root, `cd <user>` also works.
- `cd .` is a no-op; `cd ..` and `cd /` go to root.
- `add csv` expands `~` **only** for the existence check, then opens the string verbatim — avoid `~`.
- Some invalid partial commands may raise exceptions (input validation is intentionally minimal).
- The experimental `key` command path is present in code but unreachable in this build.

---

## Project Layout
```
.
├── main.py                 # entry point (runs the interactive shell)
├── documentation.txt       # printed by `documentation`
├── homework_oop/
│   └── repositories.csv    # default CSV used if path omitted (optional)
└── README.md
```
